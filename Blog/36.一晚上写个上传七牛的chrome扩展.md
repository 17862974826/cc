# 上传七牛的chrome扩展

七牛的10G [免费云存储](http://www.qiniu.com/pricing) 一直没用，正好现在拿这个做自己的cdn图床。(其实现在付费cdn的存储和流量都超便宜)

chrome扩展就是在图片上右键上传img标签里的图片，本地和远程图片都可上传。

![](http://7xiblh.com1.z0.glb.clouddn.com/img/ddf7dbaa21fb7d8ca004b5862e877ded.jpg)

## 1、七牛的API接口

新版本的七牛上传 [node-sdk](http://developer.qiniu.com/code/v6/sdk/nodejs.html#io-put) 比以前简化了很多代码，更好用了

代码 [在这](https://github.com/ccforward/qiniu/blob/master/api.js) 也就20几行，很简单。

## 2、一个HTTP服务

这一步也简单，直接 `http.createServer` 来提供一个接口获取图片的地址，然后重点就是下一步，上传图片。

## 3、上传

1. 上传前先下载到临时目录  
	这里要判断是远程线上图片还是本地在浏览器打开的图片  
	对于本地的图片地址要做 `decodeURI(url.replace('file://',''))` ，不然node找不到文件(这里被坑了一下)  
	[看这里的代码](https://github.com/ccforward/qiniu/blob/master/app.js#L46)
2. 上传临时目录的图片

## 4、chrome 扩展
先做一个简单版本，只添加了图片右键监听，点击后发送一个ajax请求到第2步中HTTP提供的接口里，异步调用上传接口。

[右键点击事件监听](https://github.com/ccforward/qiniu/blob/master/chrome/background.js#L1)

## 5、TODO

1. 加一个微博的图床接口，可以手动切换
2. 本地记录上传的日志
3. 还没想，反正基本自己用

